<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mini Royale</title>
<style>
body { margin:0; background:#111; color:white; font-family:Arial, sans-serif; text-align:center; }
canvas { display:block; margin:auto; border:3px solid gold; background:#1b1b1b; }
button { padding:12px 24px; margin:10px; font-size:16px; background:gold; border:none; cursor:pointer; }
</style>
</head>
<body>

<h2>Mini Royale</h2>
<div id="menu">
  <p>Select Game Mode:</p>
  <button onclick="startGame('solo')">Solo Royale</button>
  <button onclick="startGame('endless')">Endless</button>
  <button onclick="startGame('storm')">Storm Survival</button>
  <button onclick="startGame('creative')">Creative</button>
</div>

<canvas id="game" width="900" height="500" style="display:none;"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let keys = {}, mouse = {x:0, y:0};
let bullets = [], enemies = [], builds = [];
let stormRadius = 500, stormDamage = 0.1, enemyRate = 2000;
let score = 0, gameOver = false, victory = false;
let mode = 'solo';

const player = {x:450, y:250, hp:100, ammo:30, speed:3, mats:100};

document.addEventListener("keydown", e => keys[e.key.toLowerCase()] = true);
document.addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);
canvas.addEventListener("mousemove", e => { mouse.x = e.offsetX; mouse.y = e.offsetY; });
canvas.addEventListener("mousedown", shoot);

function startGame(selectedMode){
  mode = selectedMode;
  document.getElementById("menu").style.display = "none";
  canvas.style.display = "block";
  resetGame();
  loop();
}

function resetGame(){
  bullets=[]; enemies=[]; builds=[];
  player.x=450; player.y=250; player.hp=100; player.ammo=30; player.mats=100;
  score=0; gameOver=false; victory=false;

  if(mode==='solo'){ stormRadius=500; stormDamage=0.1; enemyRate=2000; player.mats=100; }
  if(mode==='endless'){ stormRadius=9999; stormDamage=0; enemyRate=1200; player.mats=150; }
  if(mode==='storm'){ stormRadius=350; stormDamage=0.4; enemyRate=3000; player.mats=80; }
  if(mode==='creative'){ stormRadius=9999; stormDamage=0; enemyRate=0; player.mats=9999; }
}

function shoot(){
  if(player.ammo<=0) return;
  player.ammo--;
  const dx = (mouse.x - player.x)/10;
  const dy = (mouse.y - player.y)/10;
  bullets.push({x:player.x, y:player.y, dx, dy});
}

function spawnEnemy(){
  if(enemyRate===0) return;
  enemies.push({x:Math.random()*canvas.width, y:Math.random()*canvas.height, hp:50});
}
setInterval(spawnEnemy, 1500);

function build(){
  if(player.mats < 10) return;
  player.mats -= 10;
  builds.push({x:player.x, y:player.y});
}

function update(){
  if(keys['w']) player.y -= player.speed;
  if(keys['s']) player.y += player.speed;
  if(keys['a']) player.x -= player.speed;
  if(keys['d']) player.x += player.speed;
  player.speed = keys['shift'] ? 5 : 3;

  if(keys['q']) build();

  bullets.forEach(b => { b.x += b.dx; b.y += b.dy; });

  enemies.forEach(e => {
    e.x += (player.x - e.x) * 0.01;
    e.y += (player.y - e.y) * 0.01;
  });

  bullets.forEach((b,bi)=>{
    enemies.forEach((e,ei)=>{
      if(Math.hypot(b.x-e.x, b.y-e.y)<20){
        e.hp -= 25;
        bullets.splice(bi,1);
        if(e.hp<=0){
          enemies.splice(ei,1);
          score++;
        }
      }
    });
  });

  enemies.forEach(e=>{
    if(Math.hypot(player.x-e.x, player.y-e.y)<20){
      player.hp -= 0.2;
    }
  });

  if(stormRadius<9999){
    stormRadius -= 0.05;
    if(Math.hypot(player.x-450, player.y-250)>stormRadius) player.hp -= stormDamage;
  }

  if(mode==='solo' && enemies.length===0) victory = true;
  if(player.hp<=0) gameOver = true;
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  if(stormRadius<9999){
    ctx.strokeStyle='purple';
    ctx.beginPath();
    ctx.arc(450,250,stormRadius,0,Math.PI*2);
    ctx.stroke();
  }

  builds.forEach(b => { ctx.fillStyle='#b8860b'; ctx.fillRect(b.x-20,b.y-20,40,40); });

  ctx.fillStyle='gold';
  ctx.fillRect(player.x-10, player.y-10,20,20);

  ctx.fillStyle='white';
  bullets.forEach(b => ctx.fillRect(b.x,b.y,4,4));

  ctx.fillStyle='red';
  enemies.forEach(e => ctx.fillRect(e.x-10,e.y-10,20,20));

  ctx.fillStyle='white';
  ctx.fillText(`HP: ${Math.floor(player.hp)}`, 10, 20);
  ctx.fillText(`Ammo: ${player.ammo}`, 10, 40);
  ctx.fillText(`Wood: ${player.mats}`, 10, 60);
  ctx.fillText(`Score: ${score}`, 10, 80);
  ctx.fillText(`Mode: ${mode}`, 10, 100);

  if(gameOver){
    ctx.font='40px Arial';
    ctx.fillStyle='red';
    ctx.fillText('GAME OVER', 320, 250);
    return;
  }

  if(victory){
    ctx.font='40px Arial';
    ctx.fillStyle='green';
    ctx.fillText('VICTORY!', 350, 250);
    return;
  }
}

function loop(){
  update();
  draw();
  if(!gameOver && !victory) requestAnimationFrame(loop);
}
</script>

</body>
</html>
